# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  - master
stages:
  - stage: Build
    jobs:
      - job: install_build_rust_linux
        displayName: "build on linux"
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - script: |
              curl -sSf https://sh.rustup.rs | sh -s -- --default-toolchain $RUST_TOOLCHAIN -y
            displayName: 'download and install rustup script'
          - script: "PATH=$PATH:$HOME/.cargo/bin cargo build --release"
            displayName: "cargo build"
          - publish: "$(System.DefaultWorkingDirectory)/target/release/idcfcli"
            artifact: idcfcli_exe_linux
      - job: install_build_rust_windows
        displayName: "build on windows"
        pool:
          vmImage: windows-2019
        steps:
          - script: |
              curl -sSf -o rustup-init.exe https://win.rustup.rs
              rustup-init.exe -y --default-toolchain stable
              set PATH=%PATH%;%USERPROFILE%\.cargo\bin
            displayName: "installing rustup"
          - script: "cargo build --release"
          - publish: "$(System.DefaultWorkingDirectory)/target/release/idcfcli.exe"
            artifact: idcfcli_exe_windows
          - publish: "$(System.DefaultWorkingDirectory)/target/release/idcfcli.pdb"
            artifact: idcfcli_exe_windows_pdb

